<!DOCTYPE html lang="en">
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="referrer" content="no-referrer">
    <title>TTI - A privacy focused and secure front end for roleplaying. </title>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/combine/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js,npm/crc-32@1.2,gh/syonfox/GPT-3-Encoder@c3c2e2533a15645d812b5e6fcb00b75b74718161/browser.min.js"></script>
    <script src="dexie.js"></script>
    <script src="marked.js"></script>
    <script src="DOMPurify.js"></script>
    <script type="module" src="OpenCode4.js"></script>
</head>

<body>
    <div id="topNotification" style="position:fixed; top:1rem; left:0; right:0; z-index:1000; display:none;">
        <div id="topNotificationContent"
            style="margin:0 auto; max-width:350px; background:var(--notification-bg-color); color:white; text-align: center; padding: 0.5rem; border-radius: var(--border-radius);">
        </div>
    </div>
    <div id="main" style="display:flex; position:fixed; top:0; right:0; left:0; bottom:0;">
        <div id="leftColumn"
            style="display:flex; flex-direction:column; width:255px; min-width:255px; padding:0.5rem; ">
            <div style="display:flex;">
                <button id="newThreadButton" style="width:100%; cursor:pointer; min-height:2rem;">💬 New chat</button>
                <button id="closeLeftColumnButton"
                    style="cursor:pointer; min-height:2rem; margin-left: 0.5rem; min-width: 2rem;">
                    <img src="https://ttalesinteractive.com/graphics/larrow.png" width="25" height="25" alt="Menu">
                </button>
            </div>
            <div id="threadSearchCtn" style="display:flex; width:100%; margin-top:0.5rem;">
                <input id="threadSearchInput" style="height: 100%; flex-grow: 1; min-width: 0; padding-left: 0.5rem;"
                    type="text" placeholder="search threads...">
                <button id="threadSearchButton"
                    style="cursor:pointer;min-height: 2rem;min-width: 2rem;margin-left: 0.5rem;">
                    <img src="https://ttalesinteractive.com/graphics/mg.png" width="25" height="25" alt="Thread Search">
                </button>
            </div>
            <!-- <div id="threadFolderNavigationBar" style="display:flex; width:100%; margin-top:0.5rem;">
               <button id="threadFolderBackButton" style="cursor:pointer;min-height: 2rem;min-width: 2rem;margin-left: 0.5rem;">🔙</button>
               </div> -->
            <!-- <div id="chatThreadFolders" data-current-folder-path=""></div> -->
            <div id="chatThreads" data-current-folder-path=""></div>
            <div id="appOptions">
                <div style="display: flex; width: 100%; gap: 10px;">
                    <button class="RightPanelToggle" style="width: 100%;"
                        title="Click this button to reveal/hide the news panel." onclick="togglePanel('newsPanel')">
                        News</button>
                    <button class="RightPanelToggle" style="width: 100%;"
                        title="Click this button to reveal/hide the prompt screen, custom code, and game stats."
                        onclick="togglePanel('optionsPanel')">Prompts</button>
                </div>
                <div style="display:flex;">
                    <button id="settingsButton" class="appOptionButton" style="position:relative;">
                        <div style="position: relative; display: flex; align-items: center; justify-content: center;">
                            <img src="https://ttalesinteractive.com/graphics/key.png" width="25" height="25"
                                alt="API Key Setting" style="margin-right: 5px;">
                            API key & user settings
                        </div>
                    </button>
                    <!-- <button id="statsButton" class="appOptionButton" style="margin-left: 0.5rem; width: 2rem;">📊</button> -->
                </div>
                <div style="display: flex;">
                    <button id="clearDataButton" class="appOptionButton" style="width: 4rem;">
                        <img src="https://ttalesinteractive.com/graphics/bin.png" width="25" height="25"
                            alt="Clear Data">
                    </button>
                    <button id="exportDataButton" class="appOptionButton"
                        style="position:relative; margin-left: 0.5rem; margin-right: 0.5rem;">
                        <div style="position: relative; display: flex; align-items: center;">
                            <img src="https://ttalesinteractive.com/graphics/export.png" width="25" height="25"
                                alt="Export" style="margin-right: 5px;">
                            export
                        </div>
                    </button>
                    <button class="appOptionButton" style="position:relative;">
                        <div style="position: relative; display: flex; align-items: center;">
                            <img src="https://ttalesinteractive.com/graphics/folder.png" width="25" height="25"
                                alt="Import Folder" style="margin-right: 5px;">
                            import
                        </div>
                        <input id="importDataFileInput"
                            style="position:absolute; top:0; left:0; right:0; bottom:0; opacity:0; cursor:pointer;"
                            type="file">
                    </button>
                </div>
                <button onclick="window.open('https://ttalesinteractive.com/?page_id=1542')" class="appOptionButton"
                    style="position:relative;">
                    <div style="position: relative; display: flex; align-items: center; justify-content: center;">
                        <img src="https://ttalesinteractive.com/graphics/qm.png" width="25" height="25"
                            alt="About this project" style="margin-right: 5px;">
                        About this project
                    </div>
                </button>
            </div>
        </div>
        <div id="middleColumn"
            style="flex-grow:1; display:flex; flex-direction:column; position:relative; overflow:hidden; min-width:200px; z-index:1;">
            <div id="middleColumnShadowOverlay"
                style="display:none; position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5); z-index:20;">
            </div>
            <div id="characterSelection" class="middleColumnScreen" style="flex-grow:1; display:none; overflow: auto;">
                <button id="characterSelectionOpenLeftColumnButton" class="openLeftColumnButton"
                    style="background: var(--button-bg); border-radius: var(--border-radius); border: 1px solid var(--button-border-color); padding: 0.25rem; width: 2rem; min-height: 2rem; margin-right: 0.5rem; position: absolute; top: 0.5rem; left: 0.5rem;">
                    <img src="https://ttalesinteractive.com/graphics/larrow.png" width="25" height="25"
                        alt="Left Arrow">
                </button>
                <div>
                    <h2 style="text-align:center;margin-bottom: 0.5rem;">Your Characters</h2>
                    <div style="margin-bottom: 0.5rem;display: flex;justify-content: center;">
                        <button id="newCharacterButton" style="padding: 0.25rem;">🆕 New Character</button>
                        <button id="addCharacterButton" onclick="toggleFloatingWindow()" style="margin-left: 10px;">Add
                            Character</button>
                    </div>
                </div>
                <div id="characterFoldersList" data-current-folder-path=""></div>
                <div id="characterList"></div>
                <div>
                    <h2 style="text-align:center; margin-top:4rem;">Chapter One</h2>
                </div>
                <div id="starterCharacterList"></div>
                <div>
                    <h2 style="text-align:center; margin-top:4rem;">Chapter Two</h2>
                </div>
                <div id="secondCharacterList"></div>
                <div>
                    <h2 style="text-align:center; margin-top:4rem;">Other Bots</h2>
                </div>
                <div id="otherCharacterList"></div>
                <br><br>
            </div>
            <div id="chatInterface" class="middleColumnScreen"
                style="display:flex; flex-grow:1; flex-direction:column; height:100%; position:relative;">
                <div id="customCodeChatInterfaceWrapper" style="display:none;"></div>
                <div id="builtInChatInterfaceWrapper">
                    <div id="messageFeedHeaderBar"
                        style="display: flex; position:absolute;height: 2rem;right: 0;left: 0;margin: 0.5rem; z-index:30;">
                        <button id="messageFeedOpenLeftColumnButton" class="openLeftColumnButton"
                            style="display:none; background: var(--button-bg); border-radius: var(--border-radius); border: 1px solid var(--button-border-color); padding: 0.25rem; min-width: 2rem; height: 100%; margin-right:0.5rem;">
                            <img src="https://ttalesinteractive.com/graphics/rarrow.png" width="25" height="25"
                                alt="Right Arrow">
                        </button>
                        <div
                            style="background: var(--button-bg); display:flex; height: 100%; border-radius: var(--border-radius);border: 1px solid var(--button-border-color);padding: 0.25rem;">
                            <div
                                style="display: flex;align-items: center;font-size:var(--button-font-size);margin-right: 0.25rem;">
                                model:
                            </div>
                            <select id="threadModelSelector" style="max-width:130px;"></select>
                        </div>
                        <!-- <div id="threadSettingsButton" style="margin-left:0.5rem; cursor:pointer;   background: var(--button-bg); display:flex; height: 100%; border-radius: var(--border-radius);border: 1px solid var(--button-border-color);padding: 0.25rem;">
                        <div style="display: flex;align-items: center;justify-content:center;font-size:var(--button-font-size);min-width:1.5rem;">⚙️</div>
                        </div> -->
                    </div>
                    <div id="chatBackgroundCtn"
                        style="pointer-events:none; position:absolute; top:0; left:0; right:0; bottom:0; z-index:-10;">
                    </div>
                    <div id="noMessagesNotice" style="display:none; text-align:center; padding:1rem; margin-top:4rem;">
                        Type a
                        message to begin the chat.
                    </div>
                    <div id="messageFeed" style="flex-grow:1; overflow-y:auto;"></div>
                    <div id="statusNotifier"
                        style="text-align: center; display: none; height: 0; position: relative; top: -0.4rem; display: flex; align-items: center; justify-content: center;">
                    </div>
                    <div id="inputWrapper"
                        style="display:flex; padding:0.5rem; padding-left:0; padding-right:0; flex-direction:column;">
                        <!-- <div style="display:flex;margin-bottom: 0.25rem;">
                        <button id="editReminderMessageButton" style="font-size:0.7rem;">
                        <img src="https://ttalesinteractive.com/graphics/pencil2.png" width="20" height="20" alt="Edit Reminder Message">
                        </button>
                        </div> -->
                        <div id="userMessagesSentHistoryCtn"></div>
                        <div id="shortcutButtonsCtn"></div>
                        <div style="display:flex;">
                            <textarea id="messageInput" style="flex-grow:1; min-height:4rem; font-size:100%;"
                                title="commands:&#10;/ai - prompt a reply from ai&#10;/ai &lt;instruction&gt; - prompt reply with instruction&#10;/ai @CharName#123 &lt;instruction&gt; - prompt reply with another character (ID=123)&#10;/user &lt;instruction&gt; - generate a user reply&#10;/sys &lt;message&gt; - reply as system&#10;/sum - open summary editor&#10;/mem - open memory editor&#10;/lore - open lore editor&#10;/lore &lt;text&gt; - add a lore entry&#10;/name &lt;name&gt; - set your name for this thread&#10;/avatar &lt;url&gt; - set your avatar image for this thread&#10;/import - add chat messages in bulk&#10;&#10;• You can add '/ai &lt;instruction&gt;' as the final line in your normal messages to instruct AI for its reply.&#10;• Double-click this text box to show input history"></textarea>
                            <div style="display:flex; flex-direction:column; margin-left:0.25rem;">
                                <button id="sendButton" style="min-width:80px; flex-grow:1;">send</button>
                                <div style="position:relative;">
                                    <div id="threadOptionsPopup"
                                        style="position:absolute; display:none; padding:0.5rem; background:var(--background); border-radius:var(--border-radius); width:max-content; right:0; bottom:0; border:1px solid var(--border-color);">
                                        <button id="addShortcutButton">✨ add shortcut</button>
                                        <!-- <button id="replyLoopButton">➰ reply loop</button> -->
                                    </div>
                                </div>
                                <button id="threadOptionsButton"
                                    style="min-width:80px; margin-top:0.25rem;">options</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="rightColumn" style="width:min-content;" data-visible="no">
            <div id="customCodeColumn" style="width:min-content; display:none; height:100%;">
                <div id="customCodeIframeHorizontalResizeBar"></div>
                <div id="customCodeIframeCtn" style="height:100%; flex-grow:1;"></div>
            </div>
        </div>

        <div id="newsPanel" class="TurtlePanel"></div>
        <div id="optionsPanel" class="TurtlePanel"></div>
    </div>
    <button id="toggleRightColumnButton"
        style="position:fixed; top:0.5rem; right:0.5rem; min-height:2rem; min-width:2rem; display:none; align-items:center; justify-content:center; z-index:500;">⚛️</button>
    <audio id="musicPlayer" style="display:none;"></audio>

    <div id="floating-window">
        <h1>Select a JSON or PNG file to be imported </h1>
        <button id="cancel-btn" onclick="toggleFloatingWindow()">X</button>
        <form id="fileForm" enctype="multipart/form-data">
            <label for="file" class="custom-file-label">Choose File</label>
            <input type="file" id="file" name="file" accept=".json, .png" required class="custom-file-input"
                onchange="getAlternateGreetings()" />
        </form>
        <div id="alternateGreetings"></div>
    </div>
    <div id="overlayTurtle"></div>
</body>
<script src="TurtleCharacter2.js"></script>
<script src="PanelHandler.js"></script>
<script src="TurtlePotato2.js"></script>
<script src="TurtleCode2.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

</html>